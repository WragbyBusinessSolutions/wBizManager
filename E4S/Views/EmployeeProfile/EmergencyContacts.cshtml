@model IEnumerable<E4S.Models.HumanResource.EmergencyContact>

@{
  ViewData["Title"] = "Emergency Contacts";
  Layout = "~/Views/Shared/_LayoutEmployee.cshtml";

}

<div class="content">
  <div class="card">
    <div class="card-header text-center" data-background-color="orange">
      <h3 class="card-title">
        Emergency Contact
      </h3>
      <h5 class="description">
        Information here are very important.
      </h5>
    </div>
    @*<h4 class="card-title"> Employee Jobs</h4>*@

    <div class="row">
      <div class="col-md-12">
        <div class="card ">

          <div class="card-body ">

            <!-- Start of the Emergency Contact tabs-->

            <div class="card-body">
              <div class="card-header">
                <div class="justify-content-end align-items-center ">
                  <button class="btn btn-info" data-toggle="modal" data-target="#noticeModal">Add New Contact</button>
                </div>
              </div>
              <!-- notice modal -->
              <div class="modal fade" id="noticeModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-notice">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        <i class="now-ui-icons ui-1_simple-remove"></i>
                      </button>
                      <h5 class="modal-title" id="myModalLabel">Enter New Emergency Contact</h5>
                    </div>
                    <div class="modal-body">
                      <div class="instruction">
                        <form>
                          <div class="row">
                            <div class="col-md-12">
                              <div class="form-group">
                                <label>Name</label>
                                <input id="Name" name="Name" type="text" class="form-control" placeholder="Name" required>
                              </div>
                            </div>
                          </div>

                          <div class="row">
                            <div class="col-md-12">
                              <div class="form-group">
                                <label>Relationship</label>
                                <input type="text" class="form-control" id="Relationship" name="Relationship" placeholder="Home Relationship" required>
                              </div>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-12">
                              <div class="form-group">
                                <label>Home Telephone</label>
                                <input id="HomeTelephone" name="HomeTelephone" type="text" class="form-control" placeholder="Home Telephone" required>
                              </div>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-12">
                              <div class="form-group">
                                <label>Address</label>
                                <input id="Address" name="Address" type="text" class="form-control" placeholder="Address" required>
                              </div>
                            </div>
                          </div>

                          <hr />
                          <div class="card-footer ">
                            <button type="submit" class="btn btn-fill btn-primary btn-round" id="submitEmergency">Submit</button>
                            @*<button type="button" class="btn btn-info btn-round" data-dismiss="modal">Close</button>*@
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- end notice modal -->
              <!-- notice modal -->
              <div class="modal fade" id="noticeModal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-notice">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        <i class="now-ui-icons ui-1_simple-remove"></i>
                      </button>
                      <h5 class="modal-title" id="myModalLabel"> Edit Emergency Contact Details</h5>
                    </div>
                    <div class="modal-body">
                      <div class="instruction">
                        <form>
                          <div class="row">
                            <div class="col-md-12">
                              <div class="form-group">
                                <label>Name</label>
                                <input id="eName" name="eName" type="text" class="form-control" placeholder="Name" required>
                                <input id="eemergCon" name="eemergCon" type="hidden" class="form-control" required>
                              </div>
                            </div>
                          </div>

                          <div class="row">
                            <div class="col-md-12">
                              <div class="form-group">
                                <label>Relationship</label>
                                <input type="text" class="form-control" id="eRelationship" name="eRelationship" placeholder="Home Relationship" required>
                              </div>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-12">
                              <div class="form-group">
                                <label>Home Telephone</label>
                                <input id="eHomeTelephone" name="eHomeTelephone" type="text" class="form-control" placeholder="Home Telephone" required>
                              </div>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-12">
                              <div class="form-group">
                                <label>Address</label>
                                <input id="eAddress" name="eAddress" type="text" class="form-control" placeholder="Address" required>
                              </div>
                            </div>
                          </div>

                          <hr />
                          <div class="card-footer ">
                            <button type="submit" class="btn btn-fill btn-primary btn-round" id="editEmergencyContact">Submit</button>
                            <button type="button" class="btn btn-info btn-round" data-dismiss="modal">Close</button>
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- end notice modal -->
              <div class="card-body">
                <br />
                <table id="datatable2" class="table table-striped " cellspacing="10" width="100%">
                  <thead>
                    <tr>
                      <th> Name</th>
                      <th>Relationship</th>
                      <th>Home Telephone</th>
                      <th>Address</th>
                      <th class="disabled-sorting text-right">Actions</th>
                    </tr>
                  </thead>
                  @*<tfoot>
                      <tr>
                        <th> Name</th>
                        <th>Relationship</th>
                        <th>Home Telephone</th>
                        <th>Address</th>
                        <th class="disabled-sorting text-right">Actions</th>
                      </tr>
                    </tfoot>*@
                  <tbody>

                    @foreach (var item in Model)
                    {
                      <tr>
                        <td>@item.Name</td>
                        <td>@item.Relationship</td>
                        <td>@item.HomeTelephone</td>
                        <td>@item.Address</td>
                        <td class="text-right">
                          <span data-toggle="modal" data-target="#noticeModal1"><a href="#" class="btn btn-round btn-warning btn-icon btn-sm edit" data-toggle="tooltip" data-placement="top" id="Editbtn" EmergencyContactId="@item.Id" Selected-Name="@item.Name" Selected-Relationship="@item.Relationship" Selected-HomeTelephone="@item.HomeTelephone" Selected-Address="@item.Address"><i class="far fa-calendar-alt"></i></a></span>
                            <a href="#" class="btn btn-round btn-danger btn-icon btn-sm remove" EmergencyContactId="@item.Id" EmergencyContactName="@item.Name" data-toggle="tooltip" data-placement="top" title="Click to Delete"><i class="fas fa-times"></i></a>
                        </td>
                      </tr>

                    }

                  </tbody>
                </table>
              </div>
            </div>
            <!-- the End of Emergency Contact Tabs-->

          </div>
        </div>
      </div>
    </div>
  </div>
</div>

@section Scripts {

  <script>
    $(document).ready(function () {

      $('#datatable2').DataTable({
        "pagingType": "full_numbers",
        dom: "Bfrtip",
        "lengthMenu": [
          [10, 25, 50, -1],
          [10, 25, 50, "All"]
        ],


        buttons: [
          'copy',
          'excel',
          'csv',
          'pdf',
          'print',
        ],


        responsive: true,
        language: {
          search: "_INPUT_",
          searchPlaceholder: "Search records",
        }

      });

      var table = $('#datatable2').DataTable();



      // Delete a record
      table.on('click', '.remove', function (e) {
        $tr = $(this).closest('tr');

        emergencyContactId = $(this).attr('EmergencyContactId');
        emergencyContactName = $(this).attr('EmergencyContactName');




        swal({
          title: 'Are you sure?',
          text: "You are about to delete '" + emergencyContactName + "'",
          type: 'warning',
          showCancelButton: true,
          confirmButtonClass: 'btn btn-success',
          cancelButtonClass: 'btn btn-danger',
          confirmButtonText: 'Yes, delete it!',
          buttonsStyling: false
        }).then(function () {

          $.ajax({
            type: "POST",
            url: "/EmployeeProfile/deleteEmergencyContact",
            data: JSON.stringify(emergencyContactId),
            dataType: "json",
            contentType: 'application/json; charset=utf-8',
            headers: {
              RequestVerificationToken:
                $('input:hidden[name="__RequestVerificationToken"]').val()
            },
            success: function (r) {

              if (r.msg == "Success") {

                swal({
                  title: 'Deleted!',
                  text: 'Your file has been deleted.',
                  type: 'success',
                  confirmButtonClass: "btn btn-success",
                  buttonsStyling: false
                });


              } else if (r.msg == "Fail") {

                alert(r.msg);

              } else if (r.msg == "No Data") {
                alert(r.msg);

              } else {
                alert(r.msg);
              }
              //alert(r.msg);
              // window.location.reload();

            },
            error: function () {
              alert(r.msg);
            }
          });


          table.row($tr).remove().draw();

        }).catch(swal.noop);


        e.preventDefault();
      });

      //Like record
      table.on('click', '.like', function () {
        alert('You clicked on Like button');
      });
    });
  </script>


  <script type="text/javascript">

    //$(document).ready(function() {
    //  $('.EmCon form-group input').keyup(function() {

    //      var empty = false;
    //      $('.EmCon form-group input').each(function() {
    //          if ($(this).val().length == 0) {
    //              empty = true;
    //          }
    //      });

    //      if (empty) {
    //          $('.card-footer button').attr('disabled', 'disabled');
    //      } else {
    //          $('.card-footer button').removeAttr('disabled');
    //      }
    //  });
    //});

    $(document).ready(function () {

      $("#submitEmergency").click(function (event) {

        event.preventDefault();

        var PostEmergencyContact = {
          Name: $("#Name").val(),
          Relationship: $("#Relationship").val(),
          HomeTelephone: $("#HomeTelephone").val(),
          Address: $("#Address").val(),
        };


        // console.log(Items);
        console.log(PostEmergencyContact);

        $.ajax({
          type: "POST",
          url: "/EmployeeProfile/PostEmergencyContact",
          data: JSON.stringify(PostEmergencyContact),
          dataType: "json",
          contentType: 'application/json; charset=utf-8',
          headers: {
            RequestVerificationToken:
              $('input:hidden[name="__RequestVerificationToken"]').val()
          },
          success: function (r) {

            if (r.msg == "Success") {

              demo.showSwal('success-message');

            } else if (r.msg == "Fail") {

              alert(r.msg);

            } else if (r.msg == "No Data") {
              alert(r.msg);

            } else {
              alert(r.msg);
            }
            //alert(r.msg);
            // window.location.reload();

          },
          error: function () {
            alert(r.msg);
          }
        });
      });


    });

    //Code for pulling the Records on the Table
    var eEmergCon;

    $(document).delegate('#Editbtn',
      'click',
      function (e) {

        eEmergCon = $(this).attr('EmergencyContactId');
        name = $(this).attr('Selected-Name');
        relationship = $(this).attr('Selected-Relationship');
        hometelephone = $(this).attr('Selected-HomeTelephone');
        address = $(this).attr('Selected-Address');

        //console.log(description, department);


        $('input[name=eemergCon]').val(eEmergCon);
        $('input[name=eName]').val(name);
        $('input[name=eRelationship]').val(relationship);
        $('input[name=eHomeTelephone]').val(hometelephone);
        $('input[name=eAddress]').val(address);

      });

    //End of the code

    // Edit your post

    $(document).ready(function () {

      $("#editEmergencyContact").click(function (event) {

        event.preventDefault();

        var PostEditEmergencyContact = {
          AId: $("#eemergCon").val(),
          Name: $("#eName").val(),
          Relationship: $("#eRelationship").val(),
          HomeTelephone: $("#eHomeTelephone").val(),
          Address: $("#eAddress").val(),
        };


        // console.log(Items);
        console.log(PostEditEmergencyContact);

        $.ajax({
          type: "POST",
          url: "/EmployeeProfile/editEmergencyContact",
          data: JSON.stringify(PostEditEmergencyContact),
          dataType: "json",
          contentType: 'application/json; charset=utf-8',
          headers: {
            RequestVerificationToken:
              $('input:hidden[name="__RequestVerificationToken"]').val()
          },
          success: function (r) {

            if (r.msg == "Success") {

              demo.showSwal('success-message');

            } else if (r.msg == "Fail") {

              alert(r.msg);

            } else if (r.msg == "No Data") {
              alert(r.msg);

            } else {
              alert(r.msg);
            }
            //alert(r.msg);
            // window.location.reload();

          },
          error: function () {
            alert(r.msg);
          }
        });
      });

    });

  </script>

}
