@model IEnumerable<E4S.Models.HumanResource.Dependant>

@{
  ViewData["Title"] = "Dependents";

  Layout = "~/Views/Shared/_LayoutEmployee.cshtml";
}

<div class="content">
  <div class="card">
    <div class="card-header text-center" data-background-color="orange">
      <h3 class="card-title">
        Dependents
      </h3>
      <h5 class="description">
        Fill information correctly.
      </h5>
    </div>
    @*<h4 class="card-title"> Employee Jobs</h4>*@

    <div class="row">
      <div class="col-md-12">
        <div class="card ">

            <div class="card-body ">

                <!-- Start of the Emergency Contact tabs-->


                <div class="card-header">
                    <div class="justify-content-end align-items-center ">
                        <button class="btn  btn-info" data-toggle="modal" data-target="#noticeModal">Create New</button>
                    </div>
                </div>
                <!-- notice modal -->
                <div class="modal fade" id="noticeModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-notice">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                    <i class="now-ui-icons ui-1_simple-remove"></i>
                                </button>
                                <h5 class="modal-title" id="myModalLabel">Enter New Dependents</h5>
                            </div>
                            <div class="modal-body">
                                <div class="instruction">
                                    <form>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label>Name</label>
                                                    <input id="Name" name="Name" type="text" class="form-control" placeholder="Name" required>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label>Relationship</label>
                                                    <input id="Relationship" name="Relationship" type="text" class="form-control" placeholder="Relationship" required>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label>Address</label>
                                                    <input id="Address" name="Address" type="text" class="form-control" placeholder="Address" required>
                                                </div>
                                            </div>
                                        </div>

                                        <hr />
                                        <div class="card-footer ">
                                            <button type="button" class="btn btn-fill btn-primary btn-round" id="submitDependent" >Add Dependent</button>
                                            <button type="button" class="btn btn-info btn-round" data-dismiss="modal">Close</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- end notice modal -->
                <!-- notice Edit modal -->
                <div class="modal fade" id="noticeModal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-notice">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                    <i class="now-ui-icons ui-1_simple-remove"></i>
                                </button>
                                <h5 class="modal-title" id="myModalLabel">Enter New Dependents</h5>
                            </div>
                            <div class="modal-body">
                                <div class="instruction">
                                    <form>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label>Name</label>
                                                    <input id="eName" name="eName" type="text" class="form-control" placeholder="Name" required>
                                                    <input id="edependt" name="edependt" type="hidden" class="form-control" placeholder="Name" required>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label>Relationship</label>
                                                    <input id="eRelationship" name="eRelationship" type="text" class="form-control" placeholder="Relationship" required>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label>Address</label>
                                                    <input id="eAddress" name="eAddress" type="text" class="form-control" placeholder="Address" required>
                                                </div>
                                            </div>
                                        </div>

                                        <hr />
                                        <div class="card-footer ">
                                            <button type="button" class="btn btn-fill btn-primary btn-round" id="editDependents" >Submit</button>
                                            <button type="button" class="btn btn-info btn-round" data-dismiss="modal">Close</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- end notice modal -->
                <div class="card-body">
                    <br />
                    <table id="datatable2" class="table table-striped " cellspacing="10" width="100%">
                        <thead>
                            <tr>
                                <th> Name</th>
                                <th>Relationship</th>
                                <th>Address</th>
                                <th class="disabled-sorting text-right">Actions</th>
                            </tr>
                        </thead>
                        @*<tfoot>
                  <tr>
                    <th> Name</th>
                    <th>Relationship</th>
                    <th>Address</th>
                    <th class="disabled-sorting text-right">Actions</th>
                  </tr>
                </tfoot>*@
                        <tbody>

                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td>@item.Name</td>
                                    <td>@item.Relationship</td>
                                    <td>@item.Address</td>
                                    <td class="text-right">
                                      <span data-toggle="modal" data-target="#noticeModal1"><a href="#" class="btn btn-round btn-warning btn-icon btn-sm edit" data-toggle="tooltip" data-placement="top" title="Click to Edit" id="Editbtn" DependentsId="@item.Id" Selected-Name="@item.Name" Selected-Relationship="@item.Relationship" Selected-Address="@item.Address"><i class="far fa-calendar-alt"></i></a></span>
                                        <a href="#" class="btn btn-round btn-danger btn-icon btn-sm remove" DependentId="@item.Id" DependentName="@item.Name" title="Click to Delete" data-toggle="tooltip" data-placement="top"><i class="fas fa-times"></i></a>
</td>
                                </tr>

                            }

                        </tbody>
                    </table>
                </div>
                <!-- the End of Emergency Contact Tabs-->
            </div>
        </div>
      </div>
    </div>
  </div>
</div>



@section Scripts {


  <script>
    $(document).ready(function () {

      $('#datatable2').DataTable({
        "pagingType": "full_numbers",
        dom: "Bfrtip",
        "lengthMenu": [
          [10, 25, 50, -1],
          [10, 25, 50, "All"]
        ],


        buttons: [
          'copy',
          'excel',
          'csv',
          'pdf',
          'print',
        ],


        responsive: true,
        language: {
          search: "_INPUT_",
          searchPlaceholder: "Search records",
        }

      });

      var table = $('#datatable2').DataTable();

      // Delete a record
      table.on('click', '.remove', function (e) {
        $tr = $(this).closest('tr');

        dependentId = $(this).attr('DependentId');
        dependentName = $(this).attr('DependentName');


        swal({
          title: 'Are you sure?',
          text: "You are about to delete '" + dependentName + "'",
          type: 'warning',
          showCancelButton: true,
          confirmButtonClass: 'btn btn-success',
          cancelButtonClass: 'btn btn-danger',
          confirmButtonText: 'Yes, delete it!',
          buttonsStyling: false
        }).then(function () {

          $.ajax({
            type: "POST",
            url: "/EmployeeProfile/deleteDependent",
            data: JSON.stringify(dependentId),
            dataType: "json",
            contentType: 'application/json; charset=utf-8',
            headers: {
              RequestVerificationToken:
                $('input:hidden[name="__RequestVerificationToken"]').val()
            },
            success: function (r) {

              if (r.msg == "Success") {

                swal({
                  title: 'Deleted!',
                  text: 'Your file has been deleted.',
                  type: 'success',
                  confirmButtonClass: "btn btn-success",
                  buttonsStyling: false
                });


              } else if (r.msg == "Fail") {

                alert(r.msg);

              } else if (r.msg == "No Data") {
                alert(r.msg);

              } else {
                alert(r.msg);
              }
              //alert(r.msg);
              // window.location.reload();

            },
            error: function () {
              alert(r.msg);
            }
          });


          table.row($tr).remove().draw();

        }).catch(swal.noop);


        e.preventDefault();
      });

      //Like record
      table.on('click', '.like', function () {
        alert('You clicked on Like button');
      });
    });
  </script>


  <script type="text/javascript">

    //$(document).ready(function() {
    //$('.form-group input').keyup(function() {

    //    var empty = false;
    //    $('.form-group input').each(function() {
    //        if ($(this).val().length == 0) {
    //            empty = true;
    //        }
    //    });

    //    if (empty) {
    //        $('.card-footer button').attr('disabled', 'disabled');
    //    } else {
    //        $('.card-footer button').removeAttr('disabled');
    //    }
    //});
    //});



    $(document).ready(function () {

      $("#submitDependent").click(function (event) {

        event.preventDefault();

        var PostEmergencyContact = {
          Name: $("#Name").val(),
          Relationship: $("#Relationship").val(),
          Address: $("#Address").val(),
        };


        // console.log(Items);
        console.log(PostEmergencyContact);

        $.ajax({
          type: "POST",
          url: "/EmployeeProfile/PostDependent",
          data: JSON.stringify(PostEmergencyContact),
          dataType: "json",
          contentType: 'application/json; charset=utf-8',
          headers: {
            RequestVerificationToken:
              $('input:hidden[name="__RequestVerificationToken"]').val()
          },
          success: function (r) {

            if (r.msg == "Success") {

              demo.showSwal('success-message');

            } else if (r.msg == "Fail") {

              alert(r.msg);

            } else if (r.msg == "No Data") {
              alert(r.msg);

            } else {
              alert(r.msg);
            }
            //alert(r.msg);
            // window.location.reload();

          },
          error: function () {
            alert(r.msg);
          }
        });
      });


    });


      //Code for pulling the Records on the Table  
        var eDependt;

         $(document).delegate('#Editbtn',
        'click',
        function (e) {

            eDependt = $(this).attr('DependentsId');
            name = $(this).attr('Selected-Name');
            relationship = $(this).attr('Selected-Relationship');
            address = $(this).attr('Selected-Address');
            
            //console.log(description, department);


            $('input[name=edependt]').val(eDependt);
            $('input[name=eName]').val(name);
            $('input[name=eRelationship]').val(relationship);
            $('input[name=eAddress]').val(address);
            
        });

        //End of the code

      // Edit your post 

         $(document).ready(function () {

            $("#editDependents").click(function (event) {

                event.preventDefault();

                var PostEditDependents = { 
                    AId: $("#edependt").val(),
                    Name: $("#eName").val(),
                    Relationship: $("#eRelationship").val(),
                    Address: $("#eAddress").val(),
                };


                // console.log(Items);
                console.log(PostEditDependents);

                $.ajax({
                  type: "POST",
                  url: "/EmployeeProfile/editDependents",
                  data: JSON.stringify(PostEditDependents),
                  dataType: "json",
                  contentType: 'application/json; charset=utf-8',
                  headers: {
                      RequestVerificationToken:
                      $('input:hidden[name="__RequestVerificationToken"]').val()
                  },
                  success: function (r) {

                    if (r.msg == "Success") {

                      demo.showSwal('success-message');

                    } else if (r.msg == "Fail") {

                      alert(r.msg);

                    } else if (r.msg == "No Data") {
                      alert(r.msg);

                    } else {
                      alert(r.msg);
                    }
                    //alert(r.msg);
                    // window.location.reload();

                  },
                  error: function () {
                    alert(r.msg);
                  }
                });
              });
      
            });

  </script>

}
